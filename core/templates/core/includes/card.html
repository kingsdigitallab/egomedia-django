{% load core_tags kdl_wagtail_core_tags wagtailcore_tags wagtailimages_tags %}

{% for index_page in self.get_children %}

{% for child in index_page.get_children.specific %}

{% get_page_label child as page_label %}

{% if page_label == 'themepage' or page_label == 'researcherpage' or page_label == 'projectpage' %}
<div class='cell {% get_filter_value page_label|cut:'page' child.title %}'>
  <div class='card {{ page_label }}' data-equalizer-watch='card'>
    <div class='card-divider'>
      <h3><a href='{% pageurl child %}'>{{ child.title }}</a></h3>
    </div>

    {% if child.image %}
    <a href='{% pageurl child %}'>
      {% image child.image fill-600x300-c100 %}
    </a>
    {% endif %}

    <div class='card-section'>
      {% if child.introduction %}
      <a href='{% pageurl child %}' class='intro'>
        {{ child.search_description|truncatechars:150 }}
      </a>
      {% endif %}

      {% include 'core/includes/labels.html' with page=child %}
    </div>
  </div>
</div>
{% endif %}

{% endfor %}

{% endfor %}