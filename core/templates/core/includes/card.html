{% load core_tags humanize kdl_wagtail_core_tags wagtailcore_tags wagtailimages_tags %}

{% get_page_label page as page_label %}

<div class="cell {% get_filter_value page_label|cut:'page' page.title %}">
  <div
    class="card {{ page_label }}{% if page_label == 'projectpage' and page.is_child %} child{% endif %}"
    data-equalizer-watch="card">
    <div class="card-divider">
      <h3><a href="{% pageurl page %}">{{ page.title }}</a></h3>

      {% if page_label == 'projectpage' %}
      {% for level in 123|make_list %}
      <span
        class="level {{ level|apnumber }}{% if page.depth == level|add:3 %} highlight{% endif %}"></span>
      {% if not forloop.last %}
      <span class="level neutral"></span>
      {% endif %}
      {% endfor %}
      {% endif %}
    </div>

    {% if page.image %}
    <a href="{% pageurl page %}">
      {% image page.image fill-600x300-c100 %}
    </a>
    {% endif %}

    <div class="card-section">
      {% if page.search_description %}
      <a href="{% pageurl page %}">
        {{ page.search_description|truncatechars:150 }}
      </a>
      {% endif %}

      <!-- <button class="tiny secondary button expanded button-toggler">Expand</button> -->
      <div class="hide sub">
        {% include "core/includes/labels.html" with page=page %}
      </div>
    </div>
  </div>
</div>
